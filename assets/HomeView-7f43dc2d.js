import{u as I,ac as D,w as v,a9 as x,A as K,ad as L}from"./router-a3ed6b9b.js";import{_ as R,E as $}from"./Edit-e628cf74.js";import{u as A}from"./use-message-bfd9ee41.js";import{r as z,a as E,f as s,l,m as H,k as i,j as o,a8 as g,t as k,g as p,W as h,ah as f}from"./plugin-vueexport-helper-64b0a016.js";import{_ as M,b as P,a as T,c as W,d as G}from"./Grid-cb12efef.js";import"./Icon-256e2cea.js";import"./Add-ebcce62a.js";import"./Image-397f2f14.js";import"./use-locale-24efefdf.js";import"./_createCompounder-1e09d40a.js";import"./context-67d59cb1.js";import"./index-714b5119.js";const J={id:"user_home"},O={class:"user_form"},Q={key:0,class:"title"},X={key:1,class:"title"},Y={key:2,class:"edit_button"},Z=["src"],ee={key:0,style:{"font-size":"24px"}},te={key:0,style:{"font-size":"24px"}},ae={key:0,style:{"font-size":"24px"}},ne={key:0,style:{"font-size":"24px",width:"50vw",height:"20vh"}},se={key:0},ie={key:1},oe={key:0,style:{display:"flex","justify-content":"flex"}},le={key:0,style:{display:"flex","justify-content":"flex"}},he={__name:"HomeView",setup(re){const _=I(),y=A(),C=z("medium"),b=z([]),j=a=>{console.log(a.fileList);let t=[],d=[];t=a.fileList.map(u=>u.url).filter(u=>u!==null),d=a.fileList.map(u=>u.file).filter(u=>u!==null),e.image=[...t,...d]},n=E([]),e=E({account:"",nickname:"",dc_account:"",dc_id:0,image:[],intro:"",loading:!1,updateDisabled:!0,idx:-1}),S={nickname:[{required:!0,validator(a,t){if(!t)return new Error("暱稱必填")},trigger:["input","blur"]}],dc_account:[{required:!0,validator(a,t){if(!t)return new Error("暱稱必填")},trigger:["input","blur"]}],dc_id:[{required:!0,validator(a,t){if(!t)return new Error("暱稱必填")},trigger:["input","blur"]}],email:[{required:!0,validator(a,t){if(!t)return new Error("暱稱必填")},trigger:["input","blur"]}],image:[{required:!0,validator(a,t){if(t){if(t.length>=2)return new Error("照片只能放 1 張")}else return new Error("探索者照片必放")}}]},U=a=>{console.log(a),a!==!0&&(b.value.length=0,e.account=n.account,e.nickname=n.nickname,e.dc_account=n.dc_account,e.dc_id=n.dc_id,e.email=n.email,e.image=n.image[0],e.intro=n.intro,console.log("{form.image}"),b.value.push(...e.image.map((t,d)=>({idx:d.toString(),name:d.toString(),status:"finished",url:t}))),e.loading=!1,e.updateDisabled=-1,e.idx=a),e.updateDisabled=!1},V=()=>{e.account="",e.nickname="",e.dc_account="",e.dc_id="",e.email="",e.image="",e.intro="",e.loading=!1,e.updateDisabled=!0},q=async()=>{e.loading=!0;const a=new FormData;a.append("nickname",e.nickname),a.append("dc_account",e.dc_account),a.append("dc_id",e.dc_id),a.append("intro",e.intro),e.image.length>=1&&e.image.forEach(t=>{a.append("image",t)});try{const{data:t}=await D.patch("/users/edit/"+_._id,a);n._id=t.result._id,n.account=t.result.account,n.password=t.result.password,n.email=t.result.email,n.nickname=t.result.nickname,n.image=t.result.image,n.intro=t.result.intro,n.dc_account=t.result.dc_account,n.dc_id=t.result.dc_id,y.success("探索者資料 修改成功！"),e.loading=!1,e.updateDisabled=!0}catch{y.error("探索者資料 修改失敗")}e.loading=!1};return(async()=>{try{const{data:a}=await D.get("/users/me");n._id=a.result._id,n.account=a.result.account,n.password=a.result.password,n.email=a.result.email,n.nickname=a.result.nickname,n.image=a.result.image[0],n.intro=a.result.intro,n.dc_account=a.result.dc_account,n.dc_id=a.result.dc_id,console.log(a),console.log("data.result._img:"+a.result.image[0]),console.log("myInfo.image:"+n.image)}catch{console.log(n),y.error("探索者資料取得失敗")}})(),(a,t)=>{const d=K,u=L,c=P,B=R,m=T,w=W,F=G,N=M;return s(),l("div",J,[H("div",O,[i(N,{model:e,rules:S,size:C.value,disabled:e.updateDisabled,"label-placement":"top",style:{"background-color":"#F8E9DD","border-radius":"15px",padding:"2%"},onSubmit:v(q,["prevent"])},{default:o(()=>[i(F,{cols:"6 l:12","item-responsive":"",responsive:"screen","x-gap":"30"},{default:o(()=>[i(c,{span:"12"},{default:o(()=>[i(u,{"title-placement":"left",style:{"--n-color":"#5d8585","--n-text-color":"#5d8585",margin:"-8vh 0 -10vh 0"}},{default:o(()=>[e.updateDisabled===!0?(s(),l("h2",Q,"探 索 者 檔 案")):(s(),l("h2",X,"探 索 者 檔 案 編 修 中")),e.updateDisabled===!0?(s(),l("div",Y,[i(d,{strong:"",secondary:"",disabled:e.loading,circle:"",type:"success",size:"large",style:{"font-size":"15px"},onClick:t[0]||(t[0]=r=>U(!1)),onKeydown:t[1]||(t[1]=x(v(()=>{},["prevent"]),["enter"]))},{icon:o(()=>[i(g($))]),_:1},8,["disabled"])])):k("",!0)]),_:1})]),_:1}),i(c,{span:"xs:9 m:6 l:6",label:"探索者照片",path:"image"},{default:o(()=>[e.updateDisabled===!0?(s(),l("img",{key:0,class:"user_img",src:n.image},null,8,Z)):(s(),p(B,{key:1,value:e.image,"onUpdate:value":t[2]||(t[2]=r=>e.image=r),"list-type":"image-card",multiple:"",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":b.value,onChange:j},{default:o(()=>[h(" 更改照片 ")]),_:1},8,["value","default-file-list"]))]),_:1}),i(c,{span:"xs:9 m:6 l:4",label:"探索者暱稱",path:"nickname"},{default:o(()=>[e.updateDisabled===!0?(s(),l("p",ee,f(g(_).nickname),1)):(s(),p(m,{key:1,value:e.nickname,"onUpdate:value":t[3]||(t[3]=r=>e.nickname=r),type:"text"},null,8,["value"]))]),_:1}),i(c,{span:"xs:6 m:3 l:3",label:"DC 使用者名稱",path:"dc_account"},{default:o(()=>[e.updateDisabled===!0?(s(),l("p",te,f(g(_).dc_account),1)):(s(),p(m,{key:1,value:e.dc_account,"onUpdate:value":t[4]||(t[4]=r=>e.dc_account=r),clearable:"",style:{"background-color":"#9D9FDD88"}},null,8,["value"]))]),_:1}),i(c,{span:"xs:6 m:3 l:3",label:"DC 個人識別碼",path:"dc_id"},{default:o(()=>[e.updateDisabled===!0?(s(),l("p",ae," # "+f(g(_).dc_id),1)):(s(),p(m,{key:1,value:e.dc_id,"onUpdate:value":t[5]||(t[5]=r=>e.dc_id=r),clearable:"",style:{"background-color":"#9D9FDD88"}},null,8,["value"]))]),_:1}),i(c,{span:"xs:9 m:6 l:6",label:"探索者自介",path:"notice"},{default:o(()=>[e.updateDisabled===!0?(s(),l("p",ne,[n.intro===null?(s(),l("span",se," 講點什麼讓大家更了解你吧~ ")):(s(),l("span",ie,f(n.intro),1))])):(s(),p(m,{key:1,value:e.intro,"onUpdate:value":t[6]||(t[6]=r=>e.intro=r),placeholder:"喜歡的模組風格、擅長推理或RP... 等等，能讓大家更了解你的內容都可以放在這裡喔~ :))",type:"textarea",autosize:{minRows:3,maxRows:10}},null,8,["value"]))]),_:1}),i(w,{span:"2",offset:8},{default:o(()=>[e.updateDisabled===!1?(s(),l("div",oe,[i(d,{type:"error",ghost:"",disabled:e.loading,round:"",size:"large",style:{width:"9vw",height:"2.2vw","font-size":"1rem"},onClick:t[7]||(t[7]=r=>V())},{default:o(()=>[h(" 取    消 ")]),_:1},8,["disabled"])])):k("",!0)]),_:1}),i(w,{span:"2"},{default:o(()=>[e.updateDisabled===!1?(s(),l("div",le,[i(d,{disabled:e.loading,round:"",type:"success",size:"large",style:{width:"9vw",height:"2.2vw","font-size":"1rem"},"attr-type":"submit",onKeydown:t[8]||(t[8]=x(v(()=>{},["prevent"]),["enter"]))},{default:o(()=>[h(" 存    檔 ")]),_:1},8,["disabled"])])):k("",!0)]),_:1})]),_:1})]),_:1},8,["model","size","disabled","onSubmit"])])])}}};export{he as default};
